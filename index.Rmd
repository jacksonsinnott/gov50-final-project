---
title: "Gov 50 Final Project"
author: "Jackson Sinnott"
description: "My final project"
output:
  distill::distill_article:
    self_contained: false
---

## Milestone 1: Project thoughts

I am interested in examining the phenomenon of Home Field Advantage in the MLB, and how the presence or absence of fans affects this concept. I will be using MLB data from 2015-2020, which includes the 2020 COVID-19 season when no fans were present at games.

## Milestone 2: Project Proposal

How does the presence of fans at Major League Baseball (MLB) games affect home field advantage? In this study, I plan to examine: A) home field advantage in the MLB and B) whether or not the presence or absence of fans affects home field advantage. I hypothesize that home field advantage positively affects win percentage, but that home teams who play in front of their fans have a much higher win percentage than home teams that played in empty stadiums during the 2020 COVID-19 season. I expect that teams playing on their home fields are more likely to win compared to when they are traveling and playing at "away" parks, but that playing in front of home town fans amplifies this effect, and the absence of fans diminishes the effectiveness of home field advantage. My sample is comprised of MLB game data from 2015-2020, in which the games between 2015-2019 were played under normal conditions but games played during the 2020 season were played without fans in attendance. The explanatory variable of interest is attendance, which is measured numerically by the number of people who attended each baseball game. My outcome variable is whether or not the home team won or lost the game. Currently, the data set only has the raw scores by both the home and away teams, so I will need to create a separate column for "home team outcome" that is coded =1 (win) or =0 (loss). To support my hypothesis, I will first need to confirm that home field advantage exists in the MLB. Since MLB teams play an equal amount of home and away games in their 162-game season, home field advantage would be represented by a increase in average win percentage at home compared to away. Then, using the COVID data from the 2020 season where there were no fans, a decrease in average home field win percentage would confirm my hypothesis that the presence of fans affects home field advantage. My hypothesis would be disproved either by the absence of evidence supporting home field advantage or by there being no significant change in the home field win percentage during regular years compared to the COVID year.

https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/15CITZ
https://doi.org/10.7910/DVN/15CITZ

```{r}
library(tidyverse)

MLB <- read_csv("data/Copy_of_retrosheetdata.csv")

MLB <- MLB |>
  select(-Number_of_game, -Day_of_week, -Visiting_team_game_number, -Home_team_game_number, -Length_of_game_in_outs, -Completion_information, -Forfeit_information, -Protest_information, Visiting_line_scores, -Home_line_scores)

MLB <- MLB |>
  mutate(Home_team_win = if_else(Home_team_score > Visiting_team_score, 1, 0))

MLB$Attendance <- if_else(is.na(MLB$Attendance), 0, MLB$Attendance)

MLB$Date <- as.Date(MLB$Date, format = "%m/%d/%Y")

MLB <- MLB |>
  mutate(Year = year(Date))

MLB_19 <- MLB |>
  filter(Year == 19)

MLB_20 <- MLB |>
  filter(Year == 20)

MLB_1920 <- MLB |>
  filter(Year >= 19)

MLB_healthy <- MLB |>
  filter(Year < 20)

```
## Milestone 3: One data visualization

```{r}

MLB_19 <- MLB_19 |>
  mutate(home_win_pct19 = (sum(Home_team_win == 1) / n()) * 100)

MLB_20 <- MLB_20 |>
  mutate(home_win_pct20 = (sum(Home_team_win == 1) / n()) * 100)

MLB_1920 %>% 
  group_by(Year) %>% 
  summarize(`Home Team Win %` = (mean(Home_team_win) * 100))

MLB_19
MLB_20
```

```{r}
MLB_win_pct <- MLB |> 
  group_by(Year) |>
  summarize(`Home Team Win %` = (mean(Home_team_win) * 100))

home_field_plot <- MLB_win_pct |>
  ggplot(mapping = aes(x = Year, y = `Home Team Win %`, fill = Year, color = Year)) +
  geom_col() +
  labs(title = "Home Team Win Percentage by Year",
       x = "Year",
       y = "Home Team Win Percentage") +
  ylim(0, 75)

home_field_plot

```

## Milestone 4: One analysis

```{r}
MLB <- MLB |>
  mutate(Attendance_bi = if_else(Attendance >= 1, 1, 0))

lm(Home_team_win ~ Attendance_bi, data = MLB)

```


```{r}
MLB_healthy <- MLB_healthy |>
  mutate(Attendance100 = Attendance / 100)

summary(lm(Home_team_win ~ Attendance + Home_team, data = MLB_healthy))

```
```{r}
MLB <- MLB |>
  mutate(Attendance_100 = Attendance / 100) 
summary(lm(Home_team_win ~ Attendance + Home_team, data = MLB))

```
After filtering the data to include only seasons in which fans are present at games (2015-2019), we see a positive relationship between teams with a high home team win percentage and fan turnout at these games. This could mean two things: either that good teams attract more fans, or that a greater attendance motivates teams to perform better, which would support conventional thoughts surrounding home field advantage. There are also other confounding variables to consider, such as the fact that home teams do not travel to home games, they are familiar with their setting, and get to prepare in their usual locker room and practice facilities.

However, looking at the 2020 season during COVID-19 in which no fans were present at games, we see that home teams actually have a higher average win percentage than the five previous years in the data set (Visualization 1). Through this analysis, we can infer that fan presence or attendance does not affect home team performance as much as other known and unknown varaibles, and that higher attendance metrics are more so products of team performance.